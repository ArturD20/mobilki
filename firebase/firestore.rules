rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /sets/{setId} {
      allow create: if request.auth != null
                    && request.resource.data.ownerUid == request.auth.uid
                    && request.resource.data.title is string;

      // odczyt/edycja/usunięcie zestawu — tylko właściciel
      allow read, update, delete: if request.auth != null
                                  && resource.data.ownerUid == request.auth.uid;

      match /cards/{cardId} {
        allow create, read, update, delete: if request.auth != null
          && get(/databases/$(database)/documents/sets/$(setId))
               .data.ownerUid == request.auth.uid;
      }
    }
  }
}
